version : 2.1

orbs:
  aws-eks: circleci/aws-eks@1.0.3


jobs:
  # Creating EKS Cluster using orbs
  main-cluster:
     executor: aws-eks/python3
     parameters:
       cluster-name:
         description: |
           Name of the EKS cluster
         type: string
     steps:
       - checkout
       - kubernetes/install
       - aws-eks/update-kubeconfig-with-authenticator:
           cluster-name: << parameters.cluster-name >>
           install-kubectl: true
       - run:
           name: "Services verification"
           command: |
             kubectl get services





workflows:

  deployment:
    jobs:
       - aws-eks/create-cluster:
           cluster-name: main-cluster